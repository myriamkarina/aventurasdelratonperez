<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sumas con el Rat√≥n P√©rez</title>
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#2b6cb0" />
  <style>
    :root{
      --bg:#e7f3ff; --primary:#2b6cb0; --accent:#ffd166; --ok:#2f855a; --bad:#c53030; --card:#ffffff;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:var(--bg) url('images/raton-fondo.png') repeat;
      background-size:200px;
      color:#123;
    }
    .wrap{max-width:860px;margin:0 auto;padding:24px;background:rgba(255,255,255,0.85);border-radius:20px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:16px}
    header .logo{font-size:40px}
    header h1{font-size:clamp(22px,3.5vw,36px);margin:0;color:var(--primary)}

    .card{background:var(--card);border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.08);padding:20px;position:relative;overflow:hidden}
    .card::before{content:"";background:url('images/raton-esquina.png') no-repeat bottom right/120px;opacity:0.3;position:absolute;inset:0;pointer-events:none}

    .row{display:flex;flex-wrap:wrap;gap:18px;align-items:stretch}

    .panel-quiz{flex:2 1 380px;display:grid;gap:16px;place-items:center;text-align:center}
    .problem{font-size:clamp(36px,6.5vw,70px);font-weight:800;letter-spacing:1px;color:#1a365d}

    .answer{display:flex;align-items:center;gap:10px}
    .answer input{width:140px;height:70px;border-radius:16px;border:2px solid #cbd5e1;text-align:center;font-size:38px;font-weight:700;outline:none}
    .answer input:focus{border-color:var(--primary);box-shadow:0 0 0 4px rgba(43,108,176,.15)}
    .btn{cursor:pointer;border:0;border-radius:14px;padding:14px 18px;font-weight:700}
    .btn-primary{background:var(--primary);color:white}
    .btn-ghost{background:#edf2f7;color:#1a365d}
    .btn:active{transform:translateY(1px)}

    .panel-controls{flex:1 1 260px;display:grid;gap:14px}
    .pill{background:#f1f5f9;border-radius:999px;padding:8px 12px;font-size:14px}
    .seg{display:flex;flex-wrap:wrap;gap:8px}
    .seg button{flex:1 1 100px;border:2px solid #cbd5e1;background:white;border-radius:12px;padding:10px;font-weight:700}
    .seg button.active{background:var(--accent);border-color:#e6b400}

    .keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .keypad button{height:56px;border-radius:12px;border:2px solid #cbd5e1;background:#fff;font-size:22px;font-weight:800}

    .status{min-height:44px;font-size:22px;font-weight:800}
    .ok{color:var(--ok)} .bad{color:var(--bad)}

    .celebrate{position:fixed;inset:0;display:none;place-items:center;pointer-events:none;z-index:999}
    .celebrate.show{display:grid;animation:fade .9s ease}
    @keyframes fade{from{opacity:0}to{opacity:1}}
    .banner{background:white;border-radius:24px;padding:18px 28px;box-shadow:0 10px 40px rgba(0,0,0,.2);border:6px solid var(--ok)}
    .banner h2{margin:0;font-size:clamp(40px,6vw,72px);color:var(--ok)}

    .confetti{position:fixed;inset:0;overflow:hidden;pointer-events:none;z-index:998}
    .confetti span{position:absolute;width:10px;height:16px;border-radius:2px;opacity:.9;animation:fall 1200ms linear forwards}
    @keyframes fall{to{transform:translateY(100vh) rotate(720deg);opacity:0}}

    footer{margin-top:18px;text-align:center;color:#556}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">üê≠ü¶∑</div>
      <h1>Sumas con el Rat√≥n P√©rez</h1>
    </header>

    <div class="card">
      <div class="row">
        <section class="panel-quiz" aria-live="polite">
          <div class="problem" id="problem">3 + 4 = ?</div>
          <div class="answer">
            <input id="answer" inputmode="numeric" aria-label="Tu respuesta" />
            <button class="btn btn-primary" id="btnCheck">Comprobar</button>
            <button class="btn btn-ghost" id="btnNew">Nueva cuenta</button>
          </div>
          <div class="status" id="status"></div>
        </section>

        <aside class="panel-controls">
          <div class="pill">Modo de dificultad</div>
          <div class="seg" role="group" aria-label="Dificultad">
            <button data-mode="normal" data-max="10" class="active">Hasta 10</button>
            <button data-mode="normal" data-max="20">Hasta 20</button>
            <button data-mode="normal" data-max="50">Hasta 50</button>
            <button data-mode="normal" data-max="100">Hasta 100</button>
            <button data-mode="tens">Solo dieces</button>
            <button data-mode="doubles">Solo dobles</button>
          </div>

          <div class="pill">Teclado en pantalla</div>
          <div class="keypad" aria-label="Teclado num√©rico">
            <button>7</button><button>8</button><button>9</button>
            <button>4</button><button>5</button><button>6</button>
            <button>1</button><button>2</button><button>3</button>
            <button>0</button><button id="kpDel">‚å´</button><button id="kpEnter">‚úì</button>
          </div>

          <div class="pill">Progreso</div>
          <div id="score" class="pill">Aciertos: 0 | Intentos: 0</div>
        </aside>
      </div>
    </div>

    <footer>Consejo: prob√° los modos especiales ‚ÄúSolo dieces‚Äù y ‚ÄúSolo dobles‚Äù.</footer>
  </div>

  <div class="celebrate" id="celebrate" aria-hidden="true">
    <div class="banner"><h2>¬°GENIAL! üéâ</h2></div>
  </div>
  <div class="confetti" id="confetti"></div>

  <audio id="sound-ok" src="sounds/ok.mp3" preload="auto"></audio>
  <audio id="sound-bad" src="sounds/bad.mp3" preload="auto"></audio>

  <script>
    const problemEl = document.getElementById('problem');
    const answerEl  = document.getElementById('answer');
    const statusEl  = document.getElementById('status');
    const btnCheck  = document.getElementById('btnCheck');
    const btnNew    = document.getElementById('btnNew');
    const segBtns   = document.querySelectorAll('.seg button');
    const scoreEl   = document.getElementById('score');
    const celebrate = document.getElementById('celebrate');
    const confetti  = document.getElementById('confetti');

    const soundOk = document.getElementById('sound-ok');
    const soundBad = document.getElementById('sound-bad');

    let maxResult = 10;
    let a=0,b=0, correct=0, tries=0;
    let mode = 'normal';

    function rand(n){return Math.floor(Math.random()*(n+1));}

    function newProblem(){
      if(mode==='normal'){
        do { a = rand(maxResult); b = rand(maxResult); } while (a + b > maxResult);
      } else if(mode==='tens'){
        const tens = [10,20,30,40,50,60,70,80,90];
        a = tens[Math.floor(Math.random()*tens.length)];
        b = 10;
      } else if(mode==='doubles'){
        a = rand(9)+1;
        b = a;
      }
      problemEl.textContent = `${a} + ${b} = ?`;
      answerEl.value = '';
      statusEl.textContent = '';
      answerEl.focus();
    }

    function showConfetti(){
      confetti.innerHTML = '';
      for(let i=0;i<80;i++){
        const s = document.createElement('span');
        s.style.left = Math.random()*100 + 'vw';
        s.style.top  = '-10vh';
        s.style.background = `hsl(${Math.random()*360},90%,60%)`;
        s.style.transform = `translateY(0) rotate(0)`;
        s.style.animationDelay = Math.random()*0.4 + 's';
        confetti.appendChild(s);
      }
      celebrate.classList.add('show');
      setTimeout(()=>celebrate.classList.remove('show'), 900);
      setTimeout(()=>confetti.innerHTML='',1200);
    }

    function check(){
      const val = Number(answerEl.value.trim());
      if (Number.isNaN(val)) return;
      tries++;
      if (val === a + b){
        correct++;
        statusEl.textContent = '¬°Lo lograste! ‚úÖ';
        statusEl.className = 'status ok';
        soundOk.currentTime = 0; soundOk.play();
        showConfetti();
        setTimeout(newProblem, 600);
      } else {
        statusEl.textContent = 'Ups, intent√° otra vez‚Ä¶';
        statusEl.className = 'status bad';
        soundBad.currentTime = 0; soundBad.play();
      }
      scoreEl.textContent = `Aciertos: ${correct} | Intentos: ${tries}`;
    }

    btnCheck.addEventListener('click', check);
    btnNew.addEventListener('click', newProblem);
    answerEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter') check(); });

    segBtns.forEach(btn=>btn.addEventListener('click', ()=>{
      segBtns.forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      mode = btn.dataset.mode;
      if(mode==='normal') maxResult = Number(btn.dataset.max);
      newProblem();
    }));

    document.querySelectorAll('.keypad button').forEach(k=>{
      if(k.id==='kpDel') k.addEventListener('click', ()=>answerEl.value=answerEl.value.slice(0,-1));
      else if(k.id==='kpEnter') k.addEventListener('click', check);
      else k.addEventListener('click', ()=>{ answerEl.value += k.textContent; answerEl.focus();});
    });

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(console.error);
      });
    }

    newProblem();
  </script>
</body>
</html>

<!-- Recursos esperados:
- images/raton-fondo.png : patr√≥n de fondo
- images/raton-esquina.png : ilustraci√≥n decorativa
- sounds/ok.mp3 , sounds/bad.mp3 : sonidos -->
